---
aliases: []
confidence:
created: 2025-11-21T09:21:59Z
epistemic:
journal: Daily
journal-date: 2025-11-21
last_reviewed:
modified: 2025-11-21T14:03:42Z
purpose:
review_interval:
see_also: []
source_of_truth: []
status:
tags: []
title: 2025-11-21
type:
uid:
updated:
---

```journal-nav

```

**Life Day:** 19011
**Life Week:** 2715 (67.9%)
**Life Month:** 624
**Life Year:** 52

---
Here’s how I’d answer that PR comment.

---

### Why those `runcmd` lines changed

The red block in the diff is doing two things:

- Installing and enabling xRDP.
- Creating the `~/.xsession` file.

In the new version we’ve split that out in a more cloud‑init‑idiomatic way:

1. **Install packages via `packages` instead of `apt-get` in `runcmd`**

   - Old:
     ```yaml
     runcmd:
       - sudo apt-get -y install xrdp
     ```
   - New:
     ```yaml
     packages:
       - snapd
       - ubuntu-desktop
       - xrdp
       - git
       - jq
       - unzip
     ```

   `cloud-init` installs everything in `packages` before it runs `runcmd`, so the explicit `apt-get -y install xrdp` is now redundant and was removed.

2. **Create `.xsession` with `write_files` instead of `echo > ~/.xsession`**

   - Old:
     ```yaml
     - echo "gnome-session" > ~/.xsession
     ```
   - New:
     ```yaml
     write_files:
       - path: /home/azadmin/.xsession
         permissions: '0644'
         owner: azadmin:azadmin
         content: |
           gnome-session
     ```

   Using `write_files` is the recommended pattern in the cloud‑init docs:
   - It explicitly sets the path, owner and permissions.
   - It avoids relying on whatever `$HOME` happens to be when `runcmd` runs.
   - It’s easier to reason about and safer if cloud-init is ever re-run.

3. **The service/desktop setup is still there, just simplified**

   In the final version we still run:

   ```yaml
   runcmd:
     - systemctl set-default graphical.target
     - systemctl enable xrdp
     - adduser xrdp ssl-cert
     - systemctl restart xrdp
     ...
   ```

   We just removed the unnecessary `sudo` because `runcmd` already runs as root.

---

So the short answer you can give them:

> We’re not dropping the behaviour — we’ve moved the xRDP install into the `packages` block and the `.xsession` creation into `write_files`, which is the cloud‑init‑recommended way to create files with specific ownership and permissions. The systemd/xRDP commands are still in `runcmd`, just without the redundant `sudo`.